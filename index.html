<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <h1 class="text-2xl font-bold text-indigo-600">üè™ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</h1>
                <div class="flex flex-wrap gap-2">
                    <button onclick="showTab('admin')" id="adminTab" class="px-3 py-2 rounded-lg bg-indigo-600 text-white font-medium text-sm">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
                    <button onclick="showTab('orders')" id="ordersTab" class="px-3 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
                    <button onclick="showTab('tracking')" id="trackingTab" class="px-3 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium text-sm">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</button>
                    <button onclick="showTab('manage')" id="manageTab" class="px-3 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium text-sm">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
                    <button onclick="showTab('reports')" id="reportsTab" class="px-3 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</button>
                    <button onclick="showTab('commission')" id="commissionTab" class="px-3 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium text-sm">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô</button>
                    <button onclick="showTab('products')" id="productsTab" class="px-3 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium text-sm">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- Admin Management Tab -->
        <div id="adminSection" class="tab-content active">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
                        <input type="text" id="adminId" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
                        <input type="text" id="adminName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏±‡πà‡∏ô (3-6%)</label>
                        <input type="number" id="adminCommission" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="3.00" step="0.01" min="3" max="6">
                    </div>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <button onclick="generateAdminId()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">‡∏™‡∏∏‡πà‡∏°‡∏£‡∏´‡∏±‡∏™</button>
                    <button onclick="saveAdmin()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="saveToGoogleSheet('admin')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheet</button>
                    <button onclick="loadFromGoogleSheet('admin')" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google Sheet</button>
                    <button onclick="openGoogleSheets()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">üìä ‡∏î‡∏π Google Sheets</button>
                </div>
            </div>

            <!-- Admin List -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏±‡πà‡∏ô</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="adminList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="ordersSection" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                        <textarea id="orderText" rows="12" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="02/08/68

‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏õ‡∏•‡∏≤‡∏Å‡∏•‡∏°‡∏ñ‡∏∏‡∏á‡πÅ‡∏î‡∏á‡πÑ‡∏ó‡∏¢‡∏†‡∏£‡∏ì‡πå 2*170=340
‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏±‡πà‡∏ß 35
‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏ï 2*100 200
‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≤‡∏ô‡∏≤‡∏á 120
‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä 65

‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á 70
‡∏£‡∏ß‡∏° 830

‡∏™‡πà‡∏á 7-11
‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå Niza Treetippay
Lalisa 0958229809
7-ELEVEN ËèØÁßÄÈñÄÂ∏Ç"></textarea>
                        <button onclick="parseOrder()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </div>
                    <div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</label>
                                <input type="text" id="orderId" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                <input type="date" id="orderDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                                <input type="text" id="customerName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</label>
                                <select id="orderAdmin" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm"></select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á</label>
                                <select id="shippingMethod" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                                    <option value="7-11">7-11</option>
                                    <option value="Family Mart">Family Mart</option>
                                    <option value="‡πÅ‡∏°‡∏ß‡∏î‡∏≥">‡πÅ‡∏°‡∏ß‡∏î‡∏≥</option>
                                    <option value="‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö">‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</label>
                                <input type="number" id="shippingFee" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" step="0.01">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                            <textarea id="customerAddress" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm"></textarea>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á</label>
                            <div class="border border-gray-300 rounded-lg bg-gray-50">
                                <div class="p-3 border-b bg-gray-100 flex justify-between items-center">
                                    <span class="text-sm font-medium">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                                    <button onclick="addNewItem()" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                                </div>
                                <div id="orderItems" class="p-3 min-h-20 text-sm"></div>
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</label>
                                <input type="number" id="totalAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                                <select id="orderStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                                    <option value="‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•">‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•</option>
                                    <option value="‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
                                    <option value="‡∏ï‡∏µ‡∏Å‡∏•‡∏±‡∏ö">‡∏ï‡∏µ‡∏Å‡∏•‡∏±‡∏ö</option>
                                    <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2 mt-4">
                    <button onclick="generateOrderId()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
                    <button onclick="saveOrder()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
                    <button onclick="saveToGoogleSheet('orders')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheet</button>
                    <button onclick="loadFromGoogleSheet('orders')" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google Sheet</button>
                    <button onclick="openGoogleSheets()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">üìä ‡∏î‡∏π Google Sheets</button>
                </div>
            </div>

            <!-- Sync Status Dashboard -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå Google Sheets</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-gray-600" id="syncNotSent">0</div>
                        <div class="text-sm text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-600" id="syncSending">0</div>
                        <div class="text-sm text-yellow-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600" id="syncSuccess">0</div>
                        <div class="text-sm text-green-600">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600" id="syncError">0</div>
                        <div class="text-sm text-red-600">‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="syncAllOrders()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button onclick="syncFailedOrders()" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm">üîÅ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</button>
                    <button onclick="openGoogleSheets()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">üìä ‡∏î‡∏π Google Sheets</button>
                    <button onclick="clearSyncStatus()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
                </div>
            </div>

            <!-- Orders List -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-2 py-2 text-left text-xs font-medium">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">Google Sheet</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="ordersList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tracking Tab -->
        <div id="trackingSection" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">üì¶ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</label>
                        <select id="trackingOrderSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 mb-4 text-sm"></select>
                        
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</label>
                        <input type="text" id="trackingNumber" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 mb-4 text-sm" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏">
                        
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                        <input type="file" id="trackingImage" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 mb-4 text-sm">
                        
                        <div class="flex gap-2">
                            <button onclick="updateTracking()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</button>
                            <button onclick="editTracking()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="deleteTracking()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">‡∏•‡∏ö</button>
                        </div>
                    </div>
                    <div>
                        <div id="trackingPreview" class="border border-gray-300 rounded-lg p-4 bg-gray-50 text-sm">
                            <p class="text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
                        </div>
                        <div id="trackingImagePreview" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Orders Tab -->
        <div id="manageSection" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-2 py-2 text-left text-xs font-medium">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="px-2 py-2 text-left text-xs font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="manageOrdersList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sales Reports Tab -->
        <div id="reportsSection" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                <!-- Summary Cards -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                            <p class="text-xl font-bold text-gray-900" id="todaySales">0 ‡∏ø</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                            <p class="text-xl font-bold text-gray-900" id="monthSales">0 ‡∏ø</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                            <p class="text-xl font-bold text-gray-900" id="totalOrders">0</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</p>
                            <p class="text-xl font-bold text-gray-900" id="totalAdmins">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
                    <canvas id="dailySalesChart" width="400" height="200"></canvas>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ü•ß ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á</h3>
                    <canvas id="shippingChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Top Products -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≤‡∏¢</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th>
                            </tr>
                        </thead>
                        <tbody id="topProductsList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Commission Tab -->
        <div id="commissionSection" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
                        <select id="commissionAdminFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="commissionStartDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="commissionEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                    </div>
                    <div class="flex items-end">
                        <button onclick="calculateCommission()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°</button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left text-sm font-medium">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏£‡∏ß‡∏°</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">% ‡∏Ñ‡∏≠‡∏°</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô</th>
                                <th class="px-4 py-2 text-left text-sm font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="commissionList"></tbody>
                    </table>
                </div>
            </div>

            <!-- Order Details Modal -->
            <div id="orderDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex justify-between items-center">
                                <h3 class="text-xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á <span id="modalAdminName"></span></h3>
                                <button onclick="closeOrderDetailsModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <p class="text-sm text-gray-600 mt-2">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="modalDateRange"></span></p>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <p class="text-sm text-blue-600 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                                    <p class="text-2xl font-bold text-blue-800" id="modalOrderCount">0</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <p class="text-sm text-green-600 font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p>
                                    <p class="text-2xl font-bold text-green-800" id="modalTotalSales">0‡∏ø</p>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <p class="text-sm text-yellow-600 font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                                    <p class="text-2xl font-bold text-yellow-800" id="modalNetSales">0‡∏ø</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <p class="text-sm text-purple-600 font-medium">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô</p>
                                    <p class="text-2xl font-bold text-purple-800" id="modalCommission">0‡∏ø</p>
                                </div>
                            </div>
                            
                            <h4 class="text-lg font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                            <div class="overflow-x-auto">
                                <table class="w-full table-auto">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏™‡πà‡∏á</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modalOrdersList"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Management Tab -->
        <div id="productsSection" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                                <input type="text" id="productId" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                                <input type="text" id="productName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Å‡∏£‡∏±‡∏°)</label>
                                <input type="number" id="productWeight" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0" step="0.01">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ø)</label>
                                <input type="number" id="productCost" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0" step="0.01">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏õ‡∏•‡∏µ‡∏Å (‡∏ø)</label>
                                <input type="number" id="productRetailPrice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0" step="0.01">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏™‡πà‡∏á (‡∏ø)</label>
                                <input type="number" id="productWholesalePrice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0" step="0.01">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
                                <input type="number" id="productStock" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="0" step="1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</label>
                                <input type="text" id="productBarcode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="generateProductId()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">‡∏™‡∏∏‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                            <button onclick="saveProduct()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                            <button onclick="clearProductForm()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
                        </div>
                    </div>
                    <div>
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <h3 class="text-lg font-bold text-gray-800 mb-3">üîÑ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
                            <p class="text-sm text-gray-600 mb-3">‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏°‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                            <button onclick="importProductsFromOrders()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">
                                üì• ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
                            </button>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h3 class="text-lg font-bold text-gray-800 mb-3">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-blue-600" id="totalProducts">0</p>
                                    <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-red-600" id="lowStockProducts">0</p>
                                    <p class="text-sm text-gray-600">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-green-600" id="totalStockValue">0‡∏ø</p>
                                    <p class="text-sm text-gray-600">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-purple-600" id="totalProducts2">0</p>
                                    <p class="text-sm text-gray-600">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products List -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="flex gap-2">
                        <input type="text" id="productSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm" onkeyup="searchProducts()">
                        <select id="stockFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm" onchange="filterProducts()">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="instock">‡∏°‡∏µ‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                            <option value="lowstock">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥ (‚â§10)</option>
                            <option value="outofstock">‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏Ç‡∏≤‡∏¢‡∏õ‡∏•‡∏µ‡∏Å</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏Ç‡∏≤‡∏¢‡∏™‡πà‡∏á</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</th>
                                <th class="px-3 py-2 text-left text-xs font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="productsList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let admins = JSON.parse(localStorage.getItem('admins')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let currentEditingAdmin = null;
        let currentEditingOrder = null;
        let currentEditingTracking = null;
        let currentEditingProduct = null;
        let orderItemsList = [];
        let syncStatus = {}; // Track sync status for each order

        // Google Apps Script URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby_1tVIq5TZj6MBCo27yky35dexMk8gadnGCqeDVetx4QTk6xDWag91e5JzA9F_qeJl-Q/exec';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateAdminId();
            generateOrderId();
            generateProductId();
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            
            // Set commission date range to current month
            const now = new Date();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            document.getElementById('commissionStartDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('commissionEndDate').value = lastDay.toISOString().split('T')[0];
            
            // Initialize with sample data if empty
            initializeSampleData();
            
            // Initialize sync status
            syncStatus = JSON.parse(localStorage.getItem('syncStatus')) || {};
            
            // Add event listener for shipping fee changes
            document.getElementById('shippingFee').addEventListener('input', updateOrderTotal);
            
            loadAdmins();
            loadOrders();
            loadProducts();
            updateAdminDropdowns();
            updateTrackingDropdown();
            updateManageOrders();
            updateReports();
            updateProductSummary();
            calculateCommission();
            updateSyncStatusSummary();
        });

        // Initialize sample data for demonstration
        function initializeSampleData() {
            // Add sample admins if none exist
            if (admins.length === 0) {
                admins = [
                    { id: 'ADM001', name: '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô A', commission: 5.0 },
                    { id: 'ADM002', name: '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô B', commission: 4.5 },
                    { id: 'ADM003', name: '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô C', commission: 6.0 }
                ];
                localStorage.setItem('admins', JSON.stringify(admins));
            }

            // Add sample orders if none exist
            if (orders.length === 0) {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                const twoDaysAgo = new Date(Date.now() - 172800000).toISOString().split('T')[0];
                
                orders = [
                    {
                        id: 'ORD001',
                        date: today,
                        customerName: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ',
                        admin: '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô A',
                        shippingMethod: '7-11',
                        shippingFee: 50,
                        customerAddress: '123 ‡∏ñ‡∏ô‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡∏†‡∏≤‡∏û ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô 40000',
                        totalAmount: 750,
                        status: '‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•',
                        trackingNumber: '',
                        trackingImage: '',
                        items: '<div class="flex justify-between py-1 border-b"><span>‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏±‡πà‡∏ß</span><span>1 √ó 35‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏ï</span><span>2*100 √ó 200‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≤‡∏ô‡∏≤‡∏á</span><span>1 √ó 120‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä</span><span>1 √ó 65‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠</span><span>1 √ó 80‡∏ø</span></div>'
                    },
                    {
                        id: 'ORD002',
                        date: yesterday,
                        customerName: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏î‡∏µ‡πÉ‡∏à',
                        admin: '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô B',
                        shippingMethod: 'Family Mart',
                        shippingFee: 40,
                        customerAddress: '456 ‡∏ñ‡∏ô‡∏ô‡∏®‡∏£‡∏µ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô 40000',
                        totalAmount: 520,
                        status: '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß',
                        trackingNumber: 'TH1234567890',
                        trackingImage: '',
                        items: '<div class="flex justify-between py-1 border-b"><span>‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏±‡πà‡∏ß</span><span>2 √ó 70‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏ï</span><span>1*100 √ó 100‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠</span><span>3 √ó 240‡∏ø</span></div>'
                    },
                    {
                        id: 'ORD003',
                        date: twoDaysAgo,
                        customerName: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏î‡∏≤ ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°',
                        admin: '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô C',
                        shippingMethod: '‡πÅ‡∏°‡∏ß‡∏î‡∏≥',
                        shippingFee: 60,
                        customerAddress: '789 ‡∏ñ‡∏ô‡∏ô‡∏Å‡∏±‡∏•‡∏õ‡∏û‡∏§‡∏Å‡∏©‡πå ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô 40000',
                        totalAmount: 890,
                        status: '‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•',
                        trackingNumber: '',
                        trackingImage: '',
                        items: '<div class="flex justify-between py-1 border-b"><span>‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä</span><span>4 √ó 260‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≤‡∏ô‡∏≤‡∏á</span><span>2 √ó 240‡∏ø</span></div><div class="flex justify-between py-1 border-b"><span>‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏±‡πà‡∏ß</span><span>3 √ó 105‡∏ø</span></div>'
                    }
                ];
                localStorage.setItem('orders', JSON.stringify(orders));
            }
        }

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all buttons
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Section').classList.add('active');
            
            // Add active class to selected button
            document.getElementById(tabName + 'Tab').classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById(tabName + 'Tab').classList.add('bg-indigo-600', 'text-white');

            // Update reports when switching to reports tab
            if (tabName === 'reports') {
                updateReports();
            }
        }

        // Admin Management Functions
        function generateAdminId() {
            const id = 'ADM' + Math.random().toString(36).substr(2, 6).toUpperCase();
            document.getElementById('adminId').value = id;
        }

        function saveAdmin() {
            const adminId = document.getElementById('adminId').value;
            const adminName = document.getElementById('adminName').value;
            const adminCommission = parseFloat(document.getElementById('adminCommission').value);

            if (!adminName || !adminCommission || adminCommission < 3 || adminCommission > 6) {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 3-6%', 'error');
                return;
            }

            const admin = {
                id: adminId,
                name: adminName,
                commission: adminCommission
            };

            if (currentEditingAdmin !== null) {
                admins[currentEditingAdmin] = admin;
                currentEditingAdmin = null;
            } else {
                admins.push(admin);
            }

            localStorage.setItem('admins', JSON.stringify(admins));
            loadAdmins();
            updateAdminDropdowns();
            clearAdminForm();
            
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        function editAdmin(index) {
            const admin = admins[index];
            document.getElementById('adminId').value = admin.id;
            document.getElementById('adminName').value = admin.name;
            document.getElementById('adminCommission').value = admin.commission;
            currentEditingAdmin = index;
        }

        function deleteAdmin(index) {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    admins.splice(index, 1);
                    localStorage.setItem('admins', JSON.stringify(admins));
                    loadAdmins();
                    updateAdminDropdowns();
                    Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        function clearAdminForm() {
            document.getElementById('adminName').value = '';
            document.getElementById('adminCommission').value = '';
            generateAdminId();
        }

        function loadAdmins() {
            const adminList = document.getElementById('adminList');
            adminList.innerHTML = '';

            admins.forEach((admin, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 border-b text-sm">${admin.id}</td>
                    <td class="px-4 py-2 border-b text-sm">${admin.name}</td>
                    <td class="px-4 py-2 border-b text-sm">${admin.commission}%</td>
                    <td class="px-4 py-2 border-b">
                        <button onclick="editAdmin(${index})" class="px-2 py-1 bg-blue-500 text-white rounded text-xs mr-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="deleteAdmin(${index})" class="px-2 py-1 bg-red-500 text-white rounded text-xs">‡∏•‡∏ö</button>
                    </td>
                `;
                adminList.appendChild(row);
            });
        }

        function updateAdminDropdowns() {
            const orderAdminSelect = document.getElementById('orderAdmin');
            orderAdminSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</option>';
            
            const commissionAdminFilter = document.getElementById('commissionAdminFilter');
            commissionAdminFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô</option>';
            
            admins.forEach(admin => {
                const option = document.createElement('option');
                option.value = admin.name;
                option.textContent = admin.name;
                orderAdminSelect.appendChild(option);

                const filterOption = document.createElement('option');
                filterOption.value = admin.name;
                filterOption.textContent = admin.name;
                commissionAdminFilter.appendChild(filterOption);
            });
        }

        // Order Management Functions
        function generateOrderId() {
            const id = 'ORD' + Date.now().toString().slice(-6);
            document.getElementById('orderId').value = id;
        }

        // Order Items Management Functions
        function displayOrderItems() {
            const orderItemsDiv = document.getElementById('orderItems');
            
            if (orderItemsList.length === 0) {
                orderItemsDiv.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }
            
            orderItemsDiv.innerHTML = orderItemsList.map(item => 
                `<div class="flex justify-between items-center py-2 border-b border-gray-200 hover:bg-gray-50 rounded px-2">
                    <div class="flex-1">
                        <span class="font-medium">${item.name}</span>
                        <div class="text-xs text-gray-500">${item.quantity} √ó ${item.price}‡∏ø = ${calculateItemTotal(item.quantity, item.price)}‡∏ø</div>
                    </div>
                    <div class="flex gap-1">
                        <button onclick="editItem(${item.id})" class="px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="deleteItem(${item.id})" class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">‡∏•‡∏ö</button>
                    </div>
                </div>`
            ).join('');
            
            // Update total amount
            updateOrderTotal();
        }

        function calculateItemTotal(quantity, price) {
            // Handle quantity formats like "2*100" or just "1"
            let qty = 1;
            const quantityStr = quantity.toString();
            if (quantityStr.includes('*')) {
                const parts = quantityStr.split('*');
                qty = parseInt(parts[0]) || 1;
            } else {
                qty = parseInt(quantityStr) || 1;
            }
            return qty * (parseInt(price) || 0);
        }

        function updateOrderTotal() {
            const total = orderItemsList.reduce((sum, item) => {
                return sum + calculateItemTotal(item.quantity, item.price);
            }, 0);
            
            const shippingFee = parseFloat(document.getElementById('shippingFee').value) || 0;
            document.getElementById('totalAmount').value = total + shippingFee;
        }

        function addNewItem() {
            Swal.fire({
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà',
                html: `
                    <div class="text-left">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input type="text" id="newItemName" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                            <input type="text" id="newItemQuantity" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1 ‡∏´‡∏£‡∏∑‡∏≠ 2*100">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label>
                            <input type="number" id="newItemPrice" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡πÄ‡∏û‡∏¥‡πà‡∏°',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: () => {
                    const name = document.getElementById('newItemName').value.trim();
                    const quantity = document.getElementById('newItemQuantity').value.trim();
                    const price = document.getElementById('newItemPrice').value.trim();
                    
                    if (!name || !quantity || !price) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return false;
                    }
                    
                    return { name, quantity, price: parseInt(price) };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const newItem = {
                        id: Date.now(),
                        name: result.value.name,
                        quantity: result.value.quantity,
                        price: result.value.price
                    };
                    
                    orderItemsList.push(newItem);
                    displayOrderItems();
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        function editItem(itemId) {
            const item = orderItemsList.find(i => i.id === itemId);
            if (!item) return;
            
            Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                html: `
                    <div class="text-left">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input type="text" id="editItemName" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="${item.name}">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                            <input type="text" id="editItemQuantity" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="${item.quantity}">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label>
                            <input type="number" id="editItemPrice" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="${item.price}">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: () => {
                    const name = document.getElementById('editItemName').value.trim();
                    const quantity = document.getElementById('editItemQuantity').value.trim();
                    const price = document.getElementById('editItemPrice').value.trim();
                    
                    if (!name || !quantity || !price) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return false;
                    }
                    
                    return { name, quantity, price: parseInt(price) };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const itemIndex = orderItemsList.findIndex(i => i.id === itemId);
                    if (itemIndex !== -1) {
                        orderItemsList[itemIndex] = {
                            ...orderItemsList[itemIndex],
                            name: result.value.name,
                            quantity: result.value.quantity,
                            price: result.value.price
                        };
                        displayOrderItems();
                        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    }
                }
            });
        }

        function deleteItem(itemId) {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    orderItemsList = orderItemsList.filter(item => item.id !== itemId);
                    displayOrderItems();
                    Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        function parseOrder() {
            const orderText = document.getElementById('orderText').value;
            if (!orderText) return;

            const lines = orderText.split('\n').filter(line => line.trim());
            let items = [];
            let customerName = '';
            let customerAddress = '';
            let shippingFee = 0;
            let total = 0;
            let date = '';
            let shippingMethod = '7-11';
            let foundTotal = false; // Flag to stop parsing items after total is found

            lines.forEach(line => {
                line = line.trim();
                
                // Parse date (DD/MM/YY format)
                if (line.match(/^\d{2}\/\d{2}\/\d{2,4}$/)) {
                    const [day, month, year] = line.split('/');
                    const fullYear = year.length === 2 ? '20' + year : year;
                    date = `${fullYear}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                    return;
                }
                
                // Parse customer name (usually after "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå")
                if (line.includes('‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå') && !line.includes('‡∏£‡∏ß‡∏°')) {
                    customerName = line.replace('‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå', '').trim();
                    customerAddress += line + '\n';
                    return;
                }
                
                // Parse shipping method - check for specific keywords
                if (line.includes('‡πÅ‡∏ü‡∏°‡∏¥‡∏•‡∏µ‡πà') || line.includes('Family')) {
                    shippingMethod = 'Family Mart';
                    customerAddress += line + '\n';
                    return;
                } else if (line.includes('7-11') || line.includes('7-ELEVEN') || line.includes('‡πÄ‡∏ã‡πÄ‡∏ß‡πà‡∏ô')) {
                    shippingMethod = '7-11';
                    customerAddress += line + '\n';
                    return;
                } else if (line.includes('‡πÅ‡∏°‡∏ß‡∏î‡∏≥')) {
                    shippingMethod = '‡πÅ‡∏°‡∏ß‡∏î‡∏≥';
                    customerAddress += line + '\n';
                    return;
                } else if (line.includes('‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö')) {
                    shippingMethod = '‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö';
                    customerAddress += line + '\n';
                    return;
                }
                
                // Parse shipping fee - "‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á 75"
                if (line.includes('‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á')) {
                    const feeMatch = line.match(/‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á\s+(\d+)/);
                    if (feeMatch) {
                        shippingFee = parseInt(feeMatch[1]);
                    }
                    return;
                }
                
                // Parse total - "‡∏£‡∏ß‡∏°", "‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°", "‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á"
                if (line.includes('‡∏£‡∏ß‡∏°') || line.includes('‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°')) {
                    const totalMatch = line.match(/(\d+)/);
                    if (totalMatch) {
                        total = parseInt(totalMatch[1]);
                        foundTotal = true; // Stop parsing items after this
                    }
                    return;
                }
                
                // Skip parsing items after total is found
                if (foundTotal) {
                    // Add remaining lines to customer address (like phone, store details)
                    if (line.match(/\d{10}/) || line.includes('ELEVEN') || line.includes('ÈñÄÂ∏Ç') || line.includes('‡∏™‡πà‡∏á')) {
                        customerAddress += line + '\n';
                    }
                    return;
                }
                
                // Parse phone number and store address
                if (line.match(/\d{10}/) || line.includes('ELEVEN') || line.includes('ÈñÄÂ∏Ç')) {
                    customerAddress += line + '\n';
                    return;
                }
                
                // Skip lines that are clearly not products
                if (line.includes('‡∏™‡πà‡∏á') && !line.match(/^.+\s+\d+/)) {
                    customerAddress += line + '\n';
                    return;
                }
                
                // Parse items with prices - Support multiple formats
                // Format 1: "‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏õ‡∏•‡∏≤‡∏Å‡∏•‡∏°‡∏ñ‡∏∏‡∏á‡πÅ‡∏î‡∏á‡πÑ‡∏ó‡∏¢‡∏†‡∏£‡∏ì‡πå 2*170=340" (quantity*price=total)
                // Format 2: "‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏õ‡∏•‡∏≤‡∏Å‡∏•‡∏°‡∏ñ‡∏∏‡∏á‡πÅ‡∏î‡∏á‡πÑ‡∏ó‡∏¢‡∏†‡∏£‡∏ì‡πå 2*170 340" (quantity*price total)
                // Format 3: "‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏õ‡∏•‡∏≤‡∏Å‡∏•‡∏°‡∏ñ‡∏∏‡∏á‡πÅ‡∏î‡∏á‡πÑ‡∏ó‡∏¢‡∏†‡∏£‡∏ì‡πå 340" (single price, quantity=1)
                
                // First try format with quantity*price=total or quantity*price total
                let itemMatch = line.match(/^(.+?)\s+(\d+\*\d+)\s*=?\s*(\d+)$/);
                if (itemMatch) {
                    const [, name, quantity, totalPrice] = itemMatch;
                    const productName = name.trim();
                    
                    // Skip if it's a shipping method, fee, or total keyword
                    if (productName.includes('‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á') || 
                        productName.includes('‡∏£‡∏ß‡∏°') || 
                        productName.includes('‡πÅ‡∏ü‡∏°‡∏¥‡∏•‡∏µ‡πà') || 
                        productName.includes('7-11') || 
                        productName.includes('‡πÅ‡∏°‡∏ß‡∏î‡∏≥') ||
                        productName.includes('Family')) {
                        return;
                    }
                    
                    // Extract unit price from quantity format (e.g., "2*170" -> unit price = 170)
                    const parts = quantity.split('*');
                    const unitPrice = parseInt(parts[1]) || 0;
                    
                    items.push({
                        name: productName,
                        quantity: quantity,
                        price: unitPrice
                    });
                } else {
                    // Try simple format: "‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏õ‡∏•‡∏≤‡∏Å‡∏•‡∏°‡∏ñ‡∏∏‡∏á‡πÅ‡∏î‡∏á‡πÑ‡∏ó‡∏¢‡∏†‡∏£‡∏ì‡πå 340" (quantity=1, price=340)
                    itemMatch = line.match(/^(.+?)\s+(\d+)$/);
                    if (itemMatch) {
                        const [, name, price] = itemMatch;
                        const productName = name.trim();
                        
                        // Skip if it's a shipping method, fee, or total keyword
                        if (productName.includes('‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á') || 
                            productName.includes('‡∏£‡∏ß‡∏°') || 
                            productName.includes('‡πÅ‡∏ü‡∏°‡∏¥‡∏•‡∏µ‡πà') || 
                            productName.includes('7-11') || 
                            productName.includes('‡πÅ‡∏°‡∏ß‡∏î‡∏≥') ||
                            productName.includes('Family')) {
                            return;
                        }
                        
                        items.push({
                            name: productName,
                            quantity: "1",
                            price: parseInt(price)
                        });
                    }
                }
            });

            // Update form fields
            if (date) {
                document.getElementById('orderDate').value = date;
            }
            
            document.getElementById('customerName').value = customerName;
            document.getElementById('customerAddress').value = customerAddress.trim();
            document.getElementById('shippingFee').value = shippingFee;
            document.getElementById('totalAmount').value = total;
            document.getElementById('shippingMethod').value = shippingMethod;

            // Store items in global array and display
            orderItemsList = items.map((item, index) => ({
                id: index,
                name: item.name,
                quantity: item.quantity,
                price: item.price
            }));
            
            displayOrderItems();
        }

        function saveOrder() {
            const orderId = document.getElementById('orderId').value;
            const orderDate = document.getElementById('orderDate').value;
            const customerName = document.getElementById('customerName').value;
            const orderAdmin = document.getElementById('orderAdmin').value;
            const shippingMethod = document.getElementById('shippingMethod').value;
            const shippingFee = document.getElementById('shippingFee').value;
            const customerAddress = document.getElementById('customerAddress').value;
            const totalAmount = document.getElementById('totalAmount').value;
            const orderStatus = document.getElementById('orderStatus').value;
            // Convert orderItemsList to HTML format for storage
            const orderItems = orderItemsList.map(item => 
                `<div class="flex justify-between py-1 border-b">
                    <span>${item.name}</span>
                    <span>${item.quantity} √ó ${item.price}‡∏ø</span>
                </div>`
            ).join('');

            if (!customerName || !orderAdmin || !totalAmount) {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const order = {
                id: orderId,
                date: orderDate,
                customerName,
                admin: orderAdmin,
                shippingMethod,
                shippingFee: parseFloat(shippingFee) || 0,
                customerAddress,
                totalAmount: parseFloat(totalAmount),
                status: orderStatus,
                items: orderItems,
                trackingNumber: '',
                trackingImage: ''
            };

            if (currentEditingOrder !== null) {
                orders[currentEditingOrder] = order;
                currentEditingOrder = null;
            } else {
                orders.push(order);
            }

            localStorage.setItem('orders', JSON.stringify(orders));
            loadOrders();
            updateTrackingDropdown();
            updateManageOrders();
            clearOrderForm();
            
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        function editOrder(index) {
            const order = orders[index];
            document.getElementById('orderId').value = order.id;
            document.getElementById('orderDate').value = order.date;
            document.getElementById('customerName').value = order.customerName;
            document.getElementById('orderAdmin').value = order.admin;
            document.getElementById('shippingMethod').value = order.shippingMethod;
            document.getElementById('shippingFee').value = order.shippingFee;
            document.getElementById('customerAddress').value = order.customerAddress;
            document.getElementById('totalAmount').value = order.totalAmount;
            document.getElementById('orderStatus').value = order.status;
            // Parse items from HTML back to orderItemsList
            parseItemsFromHTML(order.items);
            displayOrderItems();
            currentEditingOrder = index;
            showTab('orders');
        }

        function deleteOrder(index) {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    orders.splice(index, 1);
                    localStorage.setItem('orders', JSON.stringify(orders));
                    loadOrders();
                    updateTrackingDropdown();
                    updateManageOrders();
                    updateReports();
                    Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        function parseItemsFromHTML(itemsHTML) {
            orderItemsList = [];
            if (!itemsHTML) return;
            
            // Create temporary div to parse HTML content
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = itemsHTML;
            const itemDivs = tempDiv.querySelectorAll('div');
            
            itemDivs.forEach((div, index) => {
                const text = div.textContent.trim();
                if (!text) return;
                
                // Parse format: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏±‡πà‡∏ß 1 √ó 35‡∏ø"
                const match = text.match(/^(.+?)\s+(.+?)\s*√ó\s*(\d+)‡∏ø$/);
                if (match) {
                    const [, name, quantity, price] = match;
                    orderItemsList.push({
                        id: Date.now() + index,
                        name: name.trim(),
                        quantity: quantity.trim(),
                        price: parseInt(price)
                    });
                }
            });
        }

        function clearOrderForm() {
            document.getElementById('orderText').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('shippingFee').value = '';
            document.getElementById('totalAmount').value = '';
            document.getElementById('orderAdmin').value = '';
            orderItemsList = [];
            displayOrderItems();
            generateOrderId();
        }

        function loadOrders() {
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = '';

            orders.forEach((order, index) => {
                const row = document.createElement('tr');
                const syncStatusInfo = getSyncStatusDisplay(order.id);
                
                row.innerHTML = `
                    <td class="px-2 py-2 border-b text-xs">${order.id}</td>
                    <td class="px-2 py-2 border-b text-xs">${order.date}</td>
                    <td class="px-2 py-2 border-b text-xs">${order.customerName}</td>
                    <td class="px-2 py-2 border-b text-xs">${order.admin}</td>
                    <td class="px-2 py-2 border-b text-xs">${order.totalAmount.toLocaleString()}‡∏ø</td>
                    <td class="px-2 py-2 border-b">
                        <span class="px-2 py-1 rounded text-xs ${getStatusColor(order.status)}">${order.status}</span>
                    </td>
                    <td class="px-2 py-2 border-b text-xs">
                        ${syncStatusInfo.html}
                    </td>
                    <td class="px-2 py-2 border-b">
                        <button onclick="editOrder(${index})" class="px-2 py-1 bg-blue-500 text-white rounded text-xs mr-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="deleteOrder(${index})" class="px-2 py-1 bg-red-500 text-white rounded text-xs">‡∏•‡∏ö</button>
                    </td>
                `;
                ordersList.appendChild(row);
            });
        }

        function getStatusColor(status) {
            switch(status) {
                case '‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•': return 'bg-blue-100 text-blue-800';
                case '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß': return 'bg-green-100 text-green-800';
                case '‡∏ï‡∏µ‡∏Å‡∏•‡∏±‡∏ö': return 'bg-yellow-100 text-yellow-800';
                case '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getSyncStatusDisplay(orderId) {
            const status = syncStatus[orderId];
            
            if (!status) {
                return {
                    html: `<span class="px-2 py-1 rounded text-xs bg-gray-100 text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á</span>`,
                    canResync: false
                };
            }
            
            switch(status.status) {
                case 'syncing':
                    return {
                        html: `<span class="px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</span>`,
                        canResync: false
                    };
                case 'success':
                    return {
                        html: `<span class="px-2 py-1 rounded text-xs bg-green-100 text-green-800">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>`,
                        canResync: false
                    };
                case 'error':
                    return {
                        html: `
                            <div class="flex flex-col gap-1">
                                <span class="px-2 py-1 rounded text-xs bg-red-100 text-red-800">‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span>
                                <button onclick="resyncOrder('${orderId}')" class="px-2 py-1 bg-orange-500 text-white rounded text-xs hover:bg-orange-600">Re save</button>
                            </div>
                        `,
                        canResync: true
                    };
                default:
                    return {
                        html: `<span class="px-2 py-1 rounded text-xs bg-gray-100 text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á</span>`,
                        canResync: false
                    };
            }
        }

        function updateSyncStatus(orderId, status, message = '') {
            syncStatus[orderId] = {
                status: status,
                message: message,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('syncStatus', JSON.stringify(syncStatus));
            loadOrders(); // Refresh the orders list to show updated status
            updateSyncStatusSummary(); // Update the summary counters
        }

        function updateSyncStatusSummary() {
            let notSent = 0, sending = 0, success = 0, error = 0;
            
            orders.forEach(order => {
                const status = syncStatus[order.id];
                if (!status) {
                    notSent++;
                } else {
                    switch(status.status) {
                        case 'syncing': sending++; break;
                        case 'success': success++; break;
                        case 'error': error++; break;
                        default: notSent++; break;
                    }
                }
            });
            
            document.getElementById('syncNotSent').textContent = notSent;
            document.getElementById('syncSending').textContent = sending;
            document.getElementById('syncSuccess').textContent = success;
            document.getElementById('syncError').textContent = error;
        }

        async function syncAllOrders() {
            if (orders.length === 0) {
                Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'info');
                return;
            }
            
            await saveOrdersToGoogleSheet();
        }

        async function syncFailedOrders() {
            const failedOrders = orders.filter(order => {
                const status = syncStatus[order.id];
                return status && status.status === 'error';
            });
            
            if (failedOrders.length === 0) {
                Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'info');
                return;
            }
            
            Swal.fire({
                title: `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß...`,
                html: `
                    <div class="text-center">
                        <p class="mb-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${failedOrders.length} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="retryProgressBar" class="bg-orange-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="retryProgressText" class="mt-2 text-sm text-gray-600">0 / ${failedOrders.length}</p>
                    </div>
                `,
                allowOutsideClick: false,
                showConfirmButton: false
            });

            let successCount = 0;
            let errorCount = 0;

            for (let i = 0; i < failedOrders.length; i++) {
                const order = failedOrders[i];
                
                try {
                    // Update progress
                    const progress = ((i + 1) / failedOrders.length) * 100;
                    document.getElementById('retryProgressBar').style.width = progress + '%';
                    document.getElementById('retryProgressText').textContent = `${i + 1} / ${failedOrders.length}`;
                    
                    updateSyncStatus(order.id, 'syncing');
                    await saveOrderToGoogleSheet(order);
                    updateSyncStatus(order.id, 'success', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    successCount++;
                    
                } catch (error) {
                    updateSyncStatus(order.id, 'error', error.message);
                    errorCount++;
                }
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            Swal.fire({
                title: '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                html: `
                    <div class="text-left">
                        <p class="text-green-600 mb-2">‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${successCount} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                        <p class="text-red-600 mb-4">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${errorCount} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                    </div>
                `,
                icon: errorCount === 0 ? 'success' : 'warning',
                confirmButtonText: '‡∏õ‡∏¥‡∏î'
            });
        }

        function clearSyncStatus() {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡πâ‡∏≤‡∏á',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    syncStatus = {};
                    localStorage.setItem('syncStatus', JSON.stringify(syncStatus));
                    loadOrders();
                    updateSyncStatusSummary();
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        async function resyncOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥', 'error');
                return;
            }

            try {
                updateSyncStatus(orderId, 'syncing');
                await saveOrderToGoogleSheet(order);
                updateSyncStatus(orderId, 'success', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ã‡πâ‡∏≥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } catch (error) {
                updateSyncStatus(orderId, 'error', error.message);
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }

        // Tracking Functions
        function updateTrackingDropdown() {
            const select = document.getElementById('trackingOrderSelect');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</option>';
            
            orders.forEach((order, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${order.id} - ${order.customerName}`;
                select.appendChild(option);
            });

            select.addEventListener('change', function() {
                const index = this.value;
                if (index !== '') {
                    const order = orders[index];
                    document.getElementById('trackingPreview').innerHTML = `
                        <h4 class="font-bold mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h4>
                        <p><strong>‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå:</strong> ${order.id}</p>
                        <p><strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${order.customerName}</p>
                        <p><strong>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</strong> ${order.totalAmount.toLocaleString()}‡∏ø</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${order.status}</p>
                        ${order.trackingNumber ? `<p><strong>‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏:</strong> ${order.trackingNumber}</p>` : ''}
                    `;
                    document.getElementById('trackingNumber').value = order.trackingNumber || '';
                    
                    // Show tracking image if exists
                    const imagePreview = document.getElementById('trackingImagePreview');
                    if (order.trackingImage) {
                        imagePreview.innerHTML = `
                            <h4 class="font-bold mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏û‡∏±‡∏™‡∏î‡∏∏</h4>
                            <img src="${order.trackingImage}" class="max-w-full h-auto rounded-lg border" alt="Tracking Image">
                        `;
                    } else {
                        imagePreview.innerHTML = '';
                    }
                }
            });
        }

        function updateTracking() {
            const orderIndex = document.getElementById('trackingOrderSelect').value;
            const trackingNumber = document.getElementById('trackingNumber').value;
            const trackingImage = document.getElementById('trackingImage').files[0];

            if (orderIndex === '' || !trackingNumber) {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏', 'error');
                return;
            }

            orders[orderIndex].trackingNumber = trackingNumber;
            
            if (trackingImage) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    orders[orderIndex].trackingImage = e.target.result;
                    localStorage.setItem('orders', JSON.stringify(orders));
                    updateManageOrders();
                    updateTrackingDropdown();
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                };
                reader.readAsDataURL(trackingImage);
            } else {
                localStorage.setItem('orders', JSON.stringify(orders));
                updateManageOrders();
                updateTrackingDropdown();
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        function editTracking() {
            const orderIndex = document.getElementById('trackingOrderSelect').value;
            if (orderIndex === '') {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå', 'error');
                return;
            }
            currentEditingTracking = orderIndex;
            Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ', 'info');
        }

        function deleteTracking() {
            const orderIndex = document.getElementById('trackingOrderSelect').value;
            if (orderIndex === '') {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå', 'error');
                return;
            }

            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    orders[orderIndex].trackingNumber = '';
                    orders[orderIndex].trackingImage = '';
                    localStorage.setItem('orders', JSON.stringify(orders));
                    document.getElementById('trackingNumber').value = '';
                    document.getElementById('trackingImagePreview').innerHTML = '';
                    updateManageOrders();
                    updateTrackingDropdown();
                    Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        // Manage Orders Functions
        function updateManageOrders() {
            const manageOrdersList = document.getElementById('manageOrdersList');
            manageOrdersList.innerHTML = '';

            orders.forEach((order, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-2 py-2 border-b text-xs">${order.id}</td>
                    <td class="px-2 py-2 border-b text-xs">${order.customerName}</td>
                    <td class="px-2 py-2 border-b text-xs">${order.totalAmount.toLocaleString()}‡∏ø</td>
                    <td class="px-2 py-2 border-b text-xs">${order.trackingNumber || '-'}</td>
                    <td class="px-2 py-2 border-b">
                        <select onchange="updateOrderStatus(${index}, this.value)" class="px-2 py-1 border rounded text-xs">
                            <option value="‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•" ${order.status === '‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•' ? 'selected' : ''}>‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•</option>
                            <option value="‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" ${order.status === '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="‡∏ï‡∏µ‡∏Å‡∏•‡∏±‡∏ö" ${order.status === '‡∏ï‡∏µ‡∏Å‡∏•‡∏±‡∏ö' ? 'selected' : ''}>‡∏ï‡∏µ‡∏Å‡∏•‡∏±‡∏ö</option>
                            <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ${order.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'selected' : ''}>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                        </select>
                    </td>
                    <td class="px-2 py-2 border-b">
                        <button onclick="editOrder(${index})" class="px-2 py-1 bg-blue-500 text-white rounded text-xs mr-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="deleteOrder(${index})" class="px-2 py-1 bg-red-500 text-white rounded text-xs">‡∏•‡∏ö</button>
                    </td>
                `;
                manageOrdersList.appendChild(row);
            });
        }

        function updateOrderStatus(index, newStatus) {
            orders[index].status = newStatus;
            localStorage.setItem('orders', JSON.stringify(orders));
            loadOrders();
            updateReports();
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        // Reports Functions
        function updateReports() {
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            // Get valid orders (exclude cancelled orders)
            const validOrders = orders.filter(order => order.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
            
            // Calculate today's sales
            const todaySales = validOrders
                .filter(order => order.date === today)
                .reduce((sum, order) => sum + (parseFloat(order.totalAmount) || 0), 0);
            
            // Calculate month's sales
            const monthSales = validOrders
                .filter(order => order.date && order.date.startsWith(currentMonth))
                .reduce((sum, order) => sum + (parseFloat(order.totalAmount) || 0), 0);
            
            // Total orders
            const totalOrders = validOrders.length;
            
            // Total admins
            const totalAdmins = admins.length;
            
            document.getElementById('todaySales').textContent = todaySales.toLocaleString() + ' ‡∏ø';
            document.getElementById('monthSales').textContent = monthSales.toLocaleString() + ' ‡∏ø';
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalAdmins').textContent = totalAdmins;
            
            // Update charts and products list
            updateDailySalesChart();
            updateShippingChart();
            updateTopProducts();
        }

        function updateDailySalesChart() {
            const ctx = document.getElementById('dailySalesChart').getContext('2d');
            
            // Clear previous chart
            if (window.dailySalesChartInstance) {
                window.dailySalesChartInstance.destroy();
            }
            
            // Get last 7 days data from saved orders
            const last7Days = [];
            const salesData = [];
            const validOrders = orders.filter(order => order.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                last7Days.push(date.toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit' }));
                
                // Calculate sales for this specific date from saved orders
                const daySales = validOrders
                    .filter(order => order.date === dateStr)
                    .reduce((sum, order) => sum + (parseFloat(order.totalAmount) || 0), 0);
                salesData.push(daySales);
            }
            
            window.dailySalesChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ø)',
                        data: salesData,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: 'rgb(255, 255, 255)',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + '‡∏ø';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ' + context.parsed.y.toLocaleString() + '‡∏ø';
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        function updateShippingChart() {
            const ctx = document.getElementById('shippingChart').getContext('2d');
            
            // Clear previous chart
            if (window.shippingChartInstance) {
                window.shippingChartInstance.destroy();
            }
            
            // Count shipping methods from saved orders
            const shippingData = {};
            const validOrders = orders.filter(order => order.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
            
            validOrders.forEach(order => {
                const method = order.shippingMethod || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                shippingData[method] = (shippingData[method] || 0) + 1;
            });
            
            // If no data, show placeholder
            if (Object.keys(shippingData).length === 0) {
                shippingData['‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'] = 1;
            }
            
            window.shippingChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(shippingData),
                    datasets: [{
                        data: Object.values(shippingData),
                        backgroundColor: [
                            'rgb(59, 130, 246)',   // Blue for 7-11
                            'rgb(16, 185, 129)',   // Green for Family Mart
                            'rgb(245, 158, 11)',   // Yellow for ‡πÅ‡∏°‡∏ß‡∏î‡∏≥
                            'rgb(239, 68, 68)',    // Red for ‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö
                            'rgb(156, 163, 175)'   // Gray for others
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed * 100) / total).toFixed(1);
                                    return context.label + ': ' + context.parsed + ' ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateTopProducts() {
            const productSales = {};
            const validOrders = orders.filter(order => order.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
            
            // Parse products from saved order items
            validOrders.forEach(order => {
                if (!order.items) return;
                
                // Create temporary div to parse HTML content
                const itemsDiv = document.createElement('div');
                itemsDiv.innerHTML = order.items;
                const items = itemsDiv.querySelectorAll('div');
                
                items.forEach(item => {
                    const text = item.textContent.trim();
                    if (!text) return;
                    
                    // Try to match different patterns:
                    // Pattern 1: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏±‡πà‡∏ß 1 √ó 35‡∏ø"
                    // Pattern 2: "‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏ï 2*100 √ó 200‡∏ø"
                    const match = text.match(/^(.+?)\s+(.+?)\s*√ó\s*(\d+)‡∏ø$/);
                    if (match) {
                        const [, name, quantity, price] = match;
                        const productName = name.trim();
                        
                        if (!productSales[productName]) {
                            productSales[productName] = { quantity: 0, sales: 0, orders: 0 };
                        }
                        
                        // Parse quantity (handle formats like "2*100" or just "1")
                        let qty = 1;
                        const quantityStr = quantity.trim();
                        if (quantityStr.includes('*')) {
                            const parts = quantityStr.split('*');
                            qty = parseInt(parts[0]) || 1;
                        } else {
                            qty = parseInt(quantityStr) || 1;
                        }
                        
                        productSales[productName].quantity += qty;
                        productSales[productName].sales += parseInt(price) || 0;
                        productSales[productName].orders += 1;
                    }
                });
            });
            
            // Sort by sales amount (descending) and take top 10
            const sortedProducts = Object.entries(productSales)
                .sort((a, b) => b[1].sales - a[1].sales)
                .slice(0, 10);
            
            const topProductsList = document.getElementById('topProductsList');
            topProductsList.innerHTML = '';
            
            if (sortedProducts.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤<br>
                        <small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</small>
                    </td>
                `;
                topProductsList.appendChild(row);
                return;
            }
            
            sortedProducts.forEach(([name, data], index) => {
                const row = document.createElement('tr');
                const rankColor = index < 3 ? 'text-yellow-600 font-bold' : 'text-gray-600';
                const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                
                row.innerHTML = `
                    <td class="px-4 py-2 border-b text-sm ${rankColor}">
                        ${rankIcon} ${index + 1}
                    </td>
                    <td class="px-4 py-2 border-b text-sm font-medium">${name}</td>
                    <td class="px-4 py-2 border-b text-sm text-center">
                        ${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô<br>
                        <small class="text-gray-500">(${data.orders} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå)</small>
                    </td>
                    <td class="px-4 py-2 border-b text-sm font-bold text-green-600">
                        ${data.sales.toLocaleString()}‡∏ø
                    </td>
                `;
                topProductsList.appendChild(row);
            });
        }

        // Commission Functions
        function calculateCommission() {
            const startDate = document.getElementById('commissionStartDate').value;
            const endDate = document.getElementById('commissionEndDate').value;
            const adminFilter = document.getElementById('commissionAdminFilter').value;
            
            if (!startDate || !endDate) {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'error');
                return;
            }
            
            const commissionData = {};
            
            // Initialize admin data (filter by selected admin if specified)
            const filteredAdmins = adminFilter ? admins.filter(admin => admin.name === adminFilter) : admins;
            
            filteredAdmins.forEach(admin => {
                commissionData[admin.name] = {
                    orderCount: 0,
                    totalSales: 0,
                    totalShipping: 0,
                    netSales: 0,
                    commissionRate: admin.commission,
                    commission: 0,
                    orders: [] // Store individual orders for details
                };
            });
            
            // Calculate commission for each admin
            orders
                .filter(order => 
                    order.date >= startDate && 
                    order.date <= endDate && 
                    order.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' &&
                    commissionData[order.admin] &&
                    (!adminFilter || order.admin === adminFilter)
                )
                .forEach(order => {
                    const adminData = commissionData[order.admin];
                    adminData.orderCount++;
                    adminData.totalSales += order.totalAmount;
                    adminData.totalShipping += order.shippingFee;
                    adminData.netSales = adminData.totalSales - adminData.totalShipping;
                    adminData.commission = (adminData.netSales * adminData.commissionRate) / 100;
                    adminData.orders.push(order); // Store order for details
                });
            
            // Display commission data
            const commissionList = document.getElementById('commissionList');
            commissionList.innerHTML = '';
            
            Object.entries(commissionData).forEach(([adminName, data]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 border-b text-sm font-medium">${adminName}</td>
                    <td class="px-4 py-2 border-b text-sm">${data.orderCount}</td>
                    <td class="px-4 py-2 border-b text-sm">${data.totalSales.toLocaleString()}‡∏ø</td>
                    <td class="px-4 py-2 border-b text-sm">${data.totalShipping.toLocaleString()}‡∏ø</td>
                    <td class="px-4 py-2 border-b text-sm font-medium">${data.netSales.toLocaleString()}‡∏ø</td>
                    <td class="px-4 py-2 border-b text-sm">${data.commissionRate}%</td>
                    <td class="px-4 py-2 border-b text-sm font-bold text-green-600">${data.commission.toLocaleString()}‡∏ø</td>
                    <td class="px-4 py-2 border-b text-sm">
                        <button onclick="showOrderDetails('${adminName}', '${startDate}', '${endDate}')" 
                                class="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-xs">
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </button>
                    </td>
                `;
                commissionList.appendChild(row);
            });
        }

        function showOrderDetails(adminName, startDate, endDate) {
            // Filter orders for this admin and date range
            const adminOrders = orders.filter(order => 
                order.admin === adminName &&
                order.date >= startDate && 
                order.date <= endDate && 
                order.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            );

            if (adminOrders.length === 0) {
                Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', 'info');
                return;
            }

            // Calculate totals
            const totalSales = adminOrders.reduce((sum, order) => sum + order.totalAmount, 0);
            const totalShipping = adminOrders.reduce((sum, order) => sum + order.shippingFee, 0);
            const netSales = totalSales - totalShipping;
            const admin = admins.find(a => a.name === adminName);
            const commission = admin ? (netSales * admin.commission) / 100 : 0;

            // Update modal content
            document.getElementById('modalAdminName').textContent = adminName;
            document.getElementById('modalDateRange').textContent = `${formatThaiDate(startDate)} - ${formatThaiDate(endDate)}`;
            document.getElementById('modalOrderCount').textContent = adminOrders.length;
            document.getElementById('modalTotalSales').textContent = totalSales.toLocaleString() + '‡∏ø';
            document.getElementById('modalNetSales').textContent = netSales.toLocaleString() + '‡∏ø';
            document.getElementById('modalCommission').textContent = commission.toLocaleString() + '‡∏ø';

            // Populate orders table
            const modalOrdersList = document.getElementById('modalOrdersList');
            modalOrdersList.innerHTML = '';

            adminOrders.forEach(order => {
                const netAmount = order.totalAmount - order.shippingFee;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-3 py-2 border-b text-xs">${order.id}</td>
                    <td class="px-3 py-2 border-b text-xs">${formatThaiDate(order.date)}</td>
                    <td class="px-3 py-2 border-b text-xs">${order.customerName}</td>
                    <td class="px-3 py-2 border-b text-xs">${order.shippingMethod}</td>
                    <td class="px-3 py-2 border-b text-xs font-medium">${order.totalAmount.toLocaleString()}‡∏ø</td>
                    <td class="px-3 py-2 border-b text-xs">${order.shippingFee.toLocaleString()}‡∏ø</td>
                    <td class="px-3 py-2 border-b text-xs font-bold text-green-600">${netAmount.toLocaleString()}‡∏ø</td>
                    <td class="px-3 py-2 border-b text-xs">
                        <span class="px-2 py-1 rounded text-xs ${getStatusColor(order.status)}">${order.status}</span>
                    </td>
                    <td class="px-3 py-2 border-b text-xs">
                        <button onclick="showOrderItems('${order.id}')" 
                                class="px-2 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700">
                            ‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </button>
                    </td>
                `;
                modalOrdersList.appendChild(row);
            });

            // Show modal
            document.getElementById('orderDetailsModal').classList.remove('hidden');
        }

        function closeOrderDetailsModal() {
            document.getElementById('orderDetailsModal').classList.add('hidden');
        }

        function showOrderItems(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order || !order.items) {
                Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ', 'info');
                return;
            }

            // Create temporary div to parse HTML content
            const itemsDiv = document.createElement('div');
            itemsDiv.innerHTML = order.items;
            const items = itemsDiv.querySelectorAll('div');
            
            let itemsText = `<strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ${orderId}:</strong><br><br>`;
            items.forEach(item => {
                const text = item.textContent.trim();
                if (text) {
                    itemsText += `‚Ä¢ ${text}<br>`;
                }
            });

            Swal.fire({
                title: '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                html: itemsText,
                icon: 'info',
                confirmButtonText: '‡∏õ‡∏¥‡∏î',
                width: '500px'
            });
        }

        function formatThaiDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // Product Management Functions
        function generateProductId() {
            const id = 'PRD' + Math.random().toString(36).substr(2, 6).toUpperCase();
            document.getElementById('productId').value = id;
        }

        function saveProduct() {
            const productId = document.getElementById('productId').value;
            const productName = document.getElementById('productName').value;
            const productWeight = parseFloat(document.getElementById('productWeight').value) || 0;
            const productCost = parseFloat(document.getElementById('productCost').value) || 0;
            const productRetailPrice = parseFloat(document.getElementById('productRetailPrice').value) || 0;
            const productWholesalePrice = parseFloat(document.getElementById('productWholesalePrice').value) || 0;
            const productStock = parseInt(document.getElementById('productStock').value) || 0;
            const productBarcode = document.getElementById('productBarcode').value;

            if (!productName) {
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
                return;
            }

            const product = {
                id: productId,
                name: productName,
                weight: productWeight,
                cost: productCost,
                retailPrice: productRetailPrice,
                wholesalePrice: productWholesalePrice,
                stock: productStock,
                barcode: productBarcode,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            if (currentEditingProduct !== null) {
                products[currentEditingProduct] = { ...products[currentEditingProduct], ...product, updatedAt: new Date().toISOString() };
                currentEditingProduct = null;
            } else {
                // Check if product name already exists
                const existingProduct = products.find(p => p.name.toLowerCase() === productName.toLowerCase());
                if (existingProduct) {
                    Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'error');
                    return;
                }
                products.push(product);
            }

            localStorage.setItem('products', JSON.stringify(products));
            loadProducts();
            updateProductSummary();
            clearProductForm();
            
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        function editProduct(index) {
            const product = products[index];
            document.getElementById('productId').value = product.id;
            document.getElementById('productName').value = product.name;
            document.getElementById('productWeight').value = product.weight;
            document.getElementById('productCost').value = product.cost;
            document.getElementById('productRetailPrice').value = product.retailPrice;
            document.getElementById('productWholesalePrice').value = product.wholesalePrice;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productBarcode').value = product.barcode;
            currentEditingProduct = index;
        }

        function deleteProduct(index) {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    products.splice(index, 1);
                    localStorage.setItem('products', JSON.stringify(products));
                    loadProducts();
                    updateProductSummary();
                    Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        function updateStock(index) {
            const product = products[index];
            Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
                html: `
                    <div class="text-left">
                        <p class="mb-4"><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${product.name}</p>
                        <p class="mb-4"><strong>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                            <input type="number" id="newStock" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="${product.stock}" min="0">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: () => {
                    const newStock = parseInt(document.getElementById('newStock').value);
                    if (isNaN(newStock) || newStock < 0) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                        return false;
                    }
                    return newStock;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    products[index].stock = result.value;
                    products[index].updatedAt = new Date().toISOString();
                    localStorage.setItem('products', JSON.stringify(products));
                    loadProducts();
                    updateProductSummary();
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productWeight').value = '';
            document.getElementById('productCost').value = '';
            document.getElementById('productRetailPrice').value = '';
            document.getElementById('productWholesalePrice').value = '';
            document.getElementById('productStock').value = '';
            document.getElementById('productBarcode').value = '';
            generateProductId();
            currentEditingProduct = null;
        }

        function loadProducts() {
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';

            const filteredProducts = getFilteredProducts();

            if (filteredProducts.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="9" class="px-4 py-8 text-center text-gray-500">
                        ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
                    </td>
                `;
                productsList.appendChild(row);
                return;
            }

            filteredProducts.forEach((product, originalIndex) => {
                const actualIndex = products.findIndex(p => p.id === product.id);
                const row = document.createElement('tr');
                const stockClass = product.stock <= 0 ? 'text-red-600 font-bold' : 
                                 product.stock <= 10 ? 'text-yellow-600 font-bold' : 'text-green-600';
                
                row.innerHTML = `
                    <td class="px-3 py-2 border-b text-xs">${product.id}</td>
                    <td class="px-3 py-2 border-b text-xs font-medium">${product.name}</td>
                    <td class="px-3 py-2 border-b text-xs">${product.weight}g</td>
                    <td class="px-3 py-2 border-b text-xs">${product.cost.toLocaleString()}‡∏ø</td>
                    <td class="px-3 py-2 border-b text-xs">${product.retailPrice.toLocaleString()}‡∏ø</td>
                    <td class="px-3 py-2 border-b text-xs">${product.wholesalePrice.toLocaleString()}‡∏ø</td>
                    <td class="px-3 py-2 border-b text-xs ${stockClass}">${product.stock}</td>
                    <td class="px-3 py-2 border-b text-xs">${product.barcode || '-'}</td>
                    <td class="px-3 py-2 border-b">
                        <div class="flex flex-wrap gap-1">
                            <button onclick="editProduct(${actualIndex})" class="px-2 py-1 bg-blue-500 text-white rounded text-xs">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="updateStock(${actualIndex})" class="px-2 py-1 bg-green-500 text-white rounded text-xs">‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                            <button onclick="deleteProduct(${actualIndex})" class="px-2 py-1 bg-red-500 text-white rounded text-xs">‡∏•‡∏ö</button>
                        </div>
                    </td>
                `;
                productsList.appendChild(row);
            });
        }

        function getFilteredProducts() {
            let filtered = [...products];
            
            // Search filter
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.id.toLowerCase().includes(searchTerm) ||
                    product.barcode.toLowerCase().includes(searchTerm)
                );
            }
            
            // Stock filter
            const stockFilter = document.getElementById('stockFilter').value;
            if (stockFilter) {
                switch(stockFilter) {
                    case 'instock':
                        filtered = filtered.filter(product => product.stock > 10);
                        break;
                    case 'lowstock':
                        filtered = filtered.filter(product => product.stock > 0 && product.stock <= 10);
                        break;
                    case 'outofstock':
                        filtered = filtered.filter(product => product.stock <= 0);
                        break;
                }
            }
            
            return filtered;
        }

        function searchProducts() {
            loadProducts();
        }

        function filterProducts() {
            loadProducts();
        }

        function updateProductSummary() {
            const totalProducts = products.length;
            const lowStockProducts = products.filter(p => p.stock > 0 && p.stock <= 10).length;
            const totalStockValue = products.reduce((sum, product) => sum + (product.cost * product.stock), 0);
            
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalProducts2').textContent = totalProducts;
            document.getElementById('lowStockProducts').textContent = lowStockProducts;
            document.getElementById('totalStockValue').textContent = totalStockValue.toLocaleString() + '‡∏ø';
        }

        function importProductsFromOrders() {
            if (orders.length === 0) {
                Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'info');
                return;
            }

            Swal.fire({
                title: '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå',
                text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Extract unique products from all orders
            const productNames = new Set();
            const newProducts = [];
            let addedCount = 0;
            let existingCount = 0;

            orders.forEach(order => {
                if (!order.items) return;
                
                // Parse items from HTML
                const itemsDiv = document.createElement('div');
                itemsDiv.innerHTML = order.items;
                const items = itemsDiv.querySelectorAll('div');
                
                items.forEach(item => {
                    const text = item.textContent.trim();
                    if (!text) return;
                    
                    // Parse product name from different formats
                    const match = text.match(/^(.+?)\s+(.+?)\s*√ó\s*(\d+)‡∏ø$/);
                    if (match) {
                        const [, name, quantity, price] = match;
                        const productName = name.trim();
                        
                        if (!productNames.has(productName.toLowerCase())) {
                            productNames.add(productName.toLowerCase());
                            
                            // Check if product already exists in our products array
                            const existingProduct = products.find(p => p.name.toLowerCase() === productName.toLowerCase());
                            
                            if (!existingProduct) {
                                // Create new product with estimated data
                                const estimatedPrice = parseInt(price) || 0;
                                const newProduct = {
                                    id: 'PRD' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                                    name: productName,
                                    weight: 0, // Unknown, user can update later
                                    cost: Math.round(estimatedPrice * 0.7), // Estimate 70% of selling price as cost
                                    retailPrice: estimatedPrice,
                                    wholesalePrice: Math.round(estimatedPrice * 0.9), // Estimate 90% as wholesale
                                    stock: 0, // Unknown stock, user needs to update
                                    barcode: '',
                                    createdAt: new Date().toISOString(),
                                    updatedAt: new Date().toISOString()
                                };
                                
                                newProducts.push(newProduct);
                                addedCount++;
                            } else {
                                existingCount++;
                            }
                        }
                    }
                });
            });

            // Add new products to the array
            products.push(...newProducts);
            localStorage.setItem('products', JSON.stringify(products));
            
            // Update UI
            loadProducts();
            updateProductSummary();

            // Show results
            setTimeout(() => {
                Swal.fire({
                    title: '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                    html: `
                        <div class="text-left">
                            <p class="mb-2">‚úÖ <strong>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà:</strong> ${addedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            <p class="mb-2">‚ÑπÔ∏è <strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß:</strong> ${existingCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            <hr class="my-3">
                            <p class="text-sm text-gray-600">
                                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
                            </p>
                            <ul class="text-sm text-gray-600 mt-2 ml-4">
                                <li>‚Ä¢ ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</li>
                                <li>‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á</li>
                                <li>‚Ä¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</li>
                                <li>‚Ä¢ ‡πÄ‡∏•‡∏Ç‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</li>
                            </ul>
                        </div>
                    `,
                    icon: 'success',
                    confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß'
                });
            }, 1000);
        }

        // Google Sheets Integration
        async function saveToGoogleSheet(type) {
            if (type === 'admin') {
                await saveAdminsToGoogleSheet();
            } else if (type === 'orders') {
                await saveOrdersToGoogleSheet();
            }
        }

        async function saveAdminsToGoogleSheet() {
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô...',
                html: `
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${admins.length} ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets</p>
                        <p class="text-sm text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
                    </div>
                `,
                allowOutsideClick: false,
                showConfirmButton: false
            });

            try {
                const data = { 
                    action: 'save',
                    type: 'admin', 
                    data: admins,
                    timestamp: new Date().toISOString()
                };
                const response = await sendToGoogleSheetJSONP(data);
                
                if (response.status === 'success') {
                    Swal.fire({
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ',
                        html: `
                            <div class="text-center">
                                <div class="text-green-600 text-6xl mb-4">‚úÖ</div>
                                <p class="text-lg font-semibold mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${admins.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                <p class="text-sm text-gray-500 mt-2">‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}</p>
                            </div>
                        `,
                        icon: 'success',
                        confirmButtonText: '‡∏õ‡∏¥‡∏î',
                        timer: 3000
                    });
                } else {
                    throw new Error(response.message || 'Unknown error');
                }
            } catch (error) {
                Swal.fire({
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    html: `
                        <div class="text-center">
                            <div class="text-red-600 text-6xl mb-4">‚ùå</div>
                            <p class="text-lg font-semibold mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ</p>
                            <p class="text-gray-600">${error.message}</p>
                            <p class="text-sm text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                        </div>
                    `,
                    icon: 'error',
                    confirmButtonText: '‡∏õ‡∏¥‡∏î'
                });
            }
        }

        async function saveOrdersToGoogleSheet() {
            if (orders.length === 0) {
                Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'info');
                return;
            }

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...',
                html: `
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p class="mb-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${orders.length} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="mt-2 text-sm text-gray-600">0 / ${orders.length}</p>
                        <p class="text-xs text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</p>
                    </div>
                `,
                allowOutsideClick: false,
                showConfirmButton: false
            });

            let successCount = 0;
            let errorCount = 0;
            const errorOrders = [];

            // Process orders in batches of 5 to avoid overwhelming the server
            const batchSize = 5;
            for (let i = 0; i < orders.length; i += batchSize) {
                const batch = orders.slice(i, i + batchSize);
                const batchPromises = batch.map(async (order, batchIndex) => {
                    const globalIndex = i + batchIndex;
                    try {
                        // Update progress
                        const progress = ((globalIndex + 1) / orders.length) * 100;
                        document.getElementById('progressBar').style.width = progress + '%';
                        document.getElementById('progressText').textContent = `${globalIndex + 1} / ${orders.length}`;
                        
                        // Mark as syncing
                        updateSyncStatus(order.id, 'syncing');
                        
                        // Send to Google Sheets
                        await saveOrderToGoogleSheet(order);
                        
                        // Mark as success
                        updateSyncStatus(order.id, 'success', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                        successCount++;
                        
                    } catch (error) {
                        // Mark as error
                        updateSyncStatus(order.id, 'error', error.message);
                        errorCount++;
                        errorOrders.push({ order: order.id, error: error.message });
                    }
                });

                // Wait for current batch to complete
                await Promise.all(batchPromises);
                
                // Small delay between batches
                if (i + batchSize < orders.length) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }

            // Show final results
            if (errorCount === 0) {
                Swal.fire({
                    title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ',
                    html: `
                        <div class="text-center">
                            <div class="text-green-600 text-6xl mb-4">‚úÖ</div>
                            <p class="text-lg font-bold text-green-600 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                            <p class="text-gray-600">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${successCount} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-sm text-gray-500 mt-2">‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}</p>
                        </div>
                    `,
                    icon: 'success',
                    confirmButtonText: '‡∏õ‡∏¥‡∏î',
                    timer: 5000
                });
            } else {
                Swal.fire({
                    title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                    html: `
                        <div class="text-left">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-3">
                                <p class="text-green-600 font-semibold">‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${successCount} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                            </div>
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-3">
                                <p class="text-red-600 font-semibold">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${errorCount} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <p class="text-sm text-blue-600">
                                    üí° <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° "Re save" ‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
                                </p>
                            </div>
                        </div>
                    `,
                    icon: 'warning',
                    confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß'
                });
            }
        }

        async function saveOrderToGoogleSheet(order) {
            const data = { 
                action: 'save',
                type: 'single_order', 
                data: order,
                timestamp: new Date().toISOString()
            };
            return await sendToGoogleSheetJSONP(data);
        }

        function sendToGoogleSheetJSONP(data) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                const callbackName = 'gsCallback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Set up callback function
                window[callbackName] = function(response) {
                    // Clean up
                    document.head.removeChild(script);
                    delete window[callbackName];
                    
                    if (response && response.status === 'success') {
                        resolve(response);
                    } else {
                        reject(new Error(response?.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'));
                    }
                };

                // Create URL with parameters
                const params = new URLSearchParams({
                    callback: callbackName,
                    data: JSON.stringify(data)
                });

                script.src = `${GOOGLE_SCRIPT_URL}?${params}`;
                script.onerror = function() {
                    document.head.removeChild(script);
                    delete window[callbackName];
                    reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ'));
                };

                document.head.appendChild(script);

                // Timeout after 30 seconds
                setTimeout(() => {
                    if (window[callbackName]) {
                        document.head.removeChild(script);
                        delete window[callbackName];
                        reject(new Error('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)'));
                    }
                }, 30000);
            });
        }

        function loadFromGoogleSheet(type) {
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                html: `
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto mb-4"></div>
                        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•${type === 'admin' ? '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô' : '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå'}‡∏à‡∏≤‡∏Å Google Sheets</p>
                        <p class="text-sm text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
                    </div>
                `,
                allowOutsideClick: false,
                showConfirmButton: false
            });

            // JSONP request
            const script = document.createElement('script');
            const callbackName = 'loadCallback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            window[callbackName] = function(response) {
                // Clean up
                document.head.removeChild(script);
                delete window[callbackName];
                
                if (response && response.status === 'success') {
                    if (type === 'admin' && response.data && response.data.admins) {
                        const loadedAdmins = response.data.admins;
                        admins = loadedAdmins;
                        localStorage.setItem('admins', JSON.stringify(admins));
                        loadAdmins();
                        updateAdminDropdowns();
                        updateReports();
                        
                        Swal.fire({
                            title: '‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ',
                            html: `
                                <div class="text-center">
                                    <div class="text-green-600 text-6xl mb-4">üì•</div>
                                    <p class="text-lg font-semibold mb-2">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                                    <p class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${loadedAdmins.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                    <p class="text-sm text-gray-500 mt-2">‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}</p>
                                </div>
                            `,
                            icon: 'success',
                            confirmButtonText: '‡∏õ‡∏¥‡∏î',
                            timer: 3000
                        });
                    } else if (type === 'orders' && response.data && response.data.orders) {
                        const loadedOrders = response.data.orders;
                        orders = loadedOrders;
                        localStorage.setItem('orders', JSON.stringify(orders));
                        loadOrders();
                        updateTrackingDropdown();
                        updateManageOrders();
                        updateReports();
                        calculateCommission();
                        
                        Swal.fire({
                            title: '‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ',
                            html: `
                                <div class="text-center">
                                    <div class="text-green-600 text-6xl mb-4">üì•</div>
                                    <p class="text-lg font-semibold mb-2">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                                    <p class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${loadedOrders.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                    <p class="text-sm text-gray-500 mt-2">‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}</p>
                                </div>
                            `,
                            icon: 'success',
                            confirmButtonText: '‡∏õ‡∏¥‡∏î',
                            timer: 3000
                        });
                    } else {
                        Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'info');
                    }
                } else {
                    Swal.fire({
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        html: `
                            <div class="text-center">
                                <div class="text-red-600 text-6xl mb-4">‚ùå</div>
                                <p class="text-lg font-semibold mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p>
                                <p class="text-gray-600">${response?.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'}</p>
                                <p class="text-sm text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>
                            </div>
                        `,
                        icon: 'error',
                        confirmButtonText: '‡∏õ‡∏¥‡∏î'
                    });
                }
            };

            const params = new URLSearchParams({
                callback: callbackName,
                action: 'load',
                type: type
            });

            script.src = `${GOOGLE_SCRIPT_URL}?${params}`;
            script.onerror = function() {
                document.head.removeChild(script);
                delete window[callbackName];
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ', 'error');
            };

            document.head.appendChild(script);

            // Timeout after 30 seconds
            setTimeout(() => {
                if (window[callbackName]) {
                    document.head.removeChild(script);
                    delete window[callbackName];
                    Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)', 'error');
                }
            }, 30000);
        }

        // Open Google Sheets in new tab
        function openGoogleSheets() {
            const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1f9vkLUzr9DKJuVQOfWVTVDypjH2Z-3sevcTPSktAV0U/edit?usp=sharing';
            window.open(GOOGLE_SHEETS_URL, '_blank');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'969eaf7526602721',t:'MTc1NDMxNzEyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
